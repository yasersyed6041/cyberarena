{# Cards are used as part of the Build Workout tab in teacher_classroom.html #}
{% macro buildWorkoutCards(specs, build_type, url, courses=None) %}
    {% for spec in specs %}
        {% set outer_loop = loop %}
        <div class="card unit-card col-lg-4 col-sm-12" onclick="show_modal_card('current_{{ build_type }}_{{ outer_loop.index }}')">
            <div class="card-body">
                <h5 class="card-title">{{ spec.summary.name }}</h5>
                {% if spec.summary.tags %}
                    {% for tag in spec.summary.tags %}
                        <div class="badge filterTags text-truncate {{ tag['id'] | lower }}">{{ tag.name }}</div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        <div class="modal fade" tabindex="-1" role="dialog" id="current_{{ build_type }}_{{ loop.index }}">
            <div class="modal-dialog modal-lg" role="document" style="overflow-y: initial !important;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5>{{ spec.summary.name }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">x</span>
                        </button>
                    </div>
                    <div class="modal-body" style="overflow-y: auto; max-height: 80vh;">
                        <div class="build-tags">
                            {% if spec.summary.tags %}
                                {% for tag in spec.summary.tags %}
                                    <div class="badge {{ tag['id'] | lower }}" style="width: fit-content">{{ tag.name }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div style="border-bottom: 1px solid #e6e6e6; padding: 3px;">
                            <p>{{ spec.summary.description }}</p>
                        </div>
                        <form id="{{ build_type }}_{{ outer_loop.index }}_form" action="{{ url }}" method="post"
                              onsubmit="displayWaitingMessage('current_{{ build_type }}_{{ outer_loop.index }}');">
                            <div class="form-group">
                                <input type="hidden" name="email" id="email" />
                                <input type="hidden" name="build_file" id="build_file" value="{{ spec['id'] }}">
                            </div>
                            <div class="form-group">
                                <label for="class-expire-date-{{ outer_loop.index }}">Expires: </label>
                                <input id="class-expire-date-{{ outer_loop.index }}" class="form-control" name="expires"
                                       type="datetime-local" onchange="validateDateTime(this)">
                            </div>
                            <div id="{{ build_type }}-build-count-{{ outer_loop.index }}-div" class="form-group">
                                <label for="build-count-{{ outer_loop.index }}">Enter max number of students:</label>
                                <input id="build-count-{{ outer_loop.index }}" class="form-control" type="number" name="build_count" min="1" max="50" />
                            </div>
                            {% if spec.lms_quiz %}
                                <input name="lms_integration" value="1" type="hidden">
                                {% if courses %}
                                    <hr>
                                    <div class="form-group">
                                        <label for="quiz-due-date-{{ outer_loop.index }}">Quiz Due: </label>
                                        <input id="quiz-due-date-{{ outer_loop.index }}" class="form-control" name="lms_due_at"
                                               type="datetime-local" onchange="validateDateTime(this)">
                                    </div>
                                    <div class="form-group">
                                        <label for="lms-type-{{ outer_loop.index }}">Learning Management System: </label>
                                        <select id="lms-type-{{ outer_loop.index }}" class="form-control" name="lms_type"
                                                onchange="updateLMSCourses(this.value, '-course-select-div-{{ outer_loop.index }}')">
                                            {% for lms, value in courses.items() %}
                                                <option value="{{ lms }}">{{ lms | capitalize }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    {% for lms, value in courses.items() %}
                                        {% if lms == 'canvas' %}
                                            <div id="{{ lms }}-course-select-div-{{ outer_loop.index }}" class="form-group lms-courses">
                                                <label for="course-code-{{ outer_loop.index }}">Course Code: </label>
                                                <select id="{{ lms }}-course-code" class="form-control" name="lms_course_code">
                                                    <option value="" type="hidden" hidden="hidden" selected disabled>-- Select a Course --</option>
                                                    {% for course_id, course_name in courses[lms].items() %}
                                                        <option value="{{ course_id }}">{{ course_name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        {% else %}
                                            <div id="{{ lms }}-course-select-div-{{ outer_loop.index }}" class="form-group lms-courses"
                                                 style="display: none;">
                                                <label for="course-code-{{ outer_loop.index }}">Course Code: </label>
                                                <select id="{{ lms }}-course-code" class="form-control" name="lms_course_code">
                                                    <option value="" type="hidden" hidden="hidden" selected disabled>-- Select a Course --</option>
                                                    {% for course_id, course_name in courses[lms].items() %}
                                                        <option value="{{ course_id }}">{{ course_name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        {% endif %}
                                    {% endfor %}{# End select lms course generation #}
                                    <div class="d-flex justify-content-center">
                                        <button type="submit" id="build-{{ build_type }}-{{ loop.index }}" class="waves-effect waves-light btn-fa text-center build-workout">Build Workout!</button>
                                    </div>
                                {% else %}
                                    <div class="form-group text-center" style="background-color: lightgoldenrodyellow; border: 1px solid lightblue; border-radius: 4px;">
                                        <p style="margin-top: 1rem;"><i class="fa fa-warning"></i>No LMS courses found. Make sure to add your LMS API key in user settings first!</p>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                        <p id="build-{{ build_type }}-{{ outer_loop.index }}"
                                           class="waves-effect waves-light btn-fa text-center build-workout disabled" disabled="true"
                                           style="pointer-events: none; opacity: 70%;">Build Workout!</p>
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="d-flex justify-content-center">
                                    <button type="submit" id="build-{{ build_type }}-{{ loop.index }}" class="waves-effect waves-light btn-fa text-center build-workout">Build Workout!</button>
                                </div>
                            {% endif %}
                        </form>
                    </div> <!-- End modal-body -->
                </div> <!--End modal-content -->
            </div> <!-- End modal-dialog -->
        </div> <!-- End modal-->
    {% endfor %}
{%- endmacro %}

{% macro workoutAssessmentModals(workout_list, url) %}
    {% for workout in workout_list %}
        <div class="modal fade" tabindex="-1" role="dialog" id="modal_{{ workout['id'] }}_assessment">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5>{{ workout['id'] }} Assessment</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">x</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table table-sm assessment-table">
                            <thead>
                                <tr>
                                    <td>Question</td>
                                    <td>Response</td>
                                    <td>Answer Key</td>
                                    <td>Complete</td>
                                </tr>
                            </thead>
                            <tbody>
                                {% for question in workout.assessment %}
                                    <tr>
                                        <td>{{ question['id'] }}</td>
                                        {% if question.response %}
                                            <td>{{ question.response }}</td>
                                        {% else %}
                                            <td class="disabled">No Response</td>
                                        {% endif %}
                                        {% if question.type in ['auto', 'input'] %}
                                            <td>{{ question.answer }}</td>
                                        {% elif question.type == 'upload' %}
                                            {% if not question.comlete %}
                                                <td>
                                                    <button onclick="markComplete('{{ question['id'] }}', '{{ workout['id'] }}', '{{ url }}');">Mark Complete</button>
                                                </td>
                                            {% else %}
                                                <td>Upload accepted</td>
                                            {% endif %}
                                        {% endif %}
                                        {% if question.complete %}
                                            <td id="{{ question['id'] }}-complete" class="complete">{{ question.complete | upper }}</td>
                                        {% else %}
                                            <td id="{{ question['id'] }}-complete" class="incomplete">{{ question.complete | upper }}</td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table> <!-- End assessment table -->
                    </div> <!-- End modal-body -->
                </div> <!-- End modal-content-->
            </div> <!-- End modal-dialog -->
        </div> <!-- End modal div-->
    {% endfor %}
{% endmacro -%}

{% macro nuke_workout_modals(workout_list, url) %}
    {% for workout in workout_list %}
        <div class="modal fade" tabindex="-1" role="dialog" id="modal_{{ workout['id'] }}_nuke">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="text-center">Nuke {{ workout['id'] }} workout!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">x</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h5 class="text-center">WARNING: This action can't be undone!</h5>
                        <p>Nuking the workout will destroy and rebuild all machines for the current workout. Any student progress on the machines
                        will be lost!</p>
                    </div>
                     <div class="modal-footer" style="justify-content:space-around;">
                        <button type="button" style="margin-right: 1em;" class="btn-fa popup_close" data-dismiss="modal">Cancel</button>
                        <button class="btn-fa btn-delete" onclick="nuke('{{ url }}/{{ workout['id'] }}', 'modal_{{ workout['id'] }}_nuke');">Continue?</button>
                     </div>
                </div>
            </div>
         </div>
    {% endfor %}
{% endmacro -%}
