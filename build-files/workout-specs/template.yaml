# This template provides an overview of the YAML specification for Cyber Gym
# workout configurations. Use this as a basis for creating new YAML config files

# General notes:
# YAML is aware of spacing and tabs. Use tabs to indent sub-entries,
# but only use spaces to separate tags from values.
# a dash ('-') indicates the beginning of a list item. Additional tags and values
# for a list item should be indented. Subsequent list items should begin with a dash.

version: '1'

# Insert basic workout information here.
workout:
  name: # Name
  workout_description: # Enclose this in quotes. Include all relevant description and instructions for the workout here.
  student_instructions_url:
  teacher_instructions_url:
  project_api_key_type: cloud
  hourly_cost: #Used to calculate an estimated cost for a workout. ~0.05 + (0.05 * ls) + (0.09 * ws) + (0.09 * lm) + (0.19 * wm)
               #ls = linux n1-standard-1, lm = linux n1-standard-2
               #ws = windows n1-standard-1, wm = windows n1-standard-2

additional_build_directives:  # BETA: Optional to include broad directives in the unit's build
  combine_student_networks: # whether to route all student workouts in the unit according to specifications
    network:  # Which network needs to combine? Commonly the external network
    subnet:   # The dynamic subnet to use when combining. Defaults to 10.1.0.0/16

student_entry: # Specifications for building the Apache Guacamole server
  type: # Either RDP or VNC
  security-mode: # Optional: default "Any"
  domain: # Optionally used for connecting to Active Directory servers
  username: # The username for accessing RDP connections
  password: # The password used for connecting both RDP and VNC connections
  network: # The network in which to place the Gucamole server
  ip: # IP address the guacamole server should connect to

# List all networks and all subnets here
networks:
  - name: # The network name is arbitrary, but be consistent as this will be referenced by subnets, VMs, routes, and firewall rules
    # Multiple subnets can be listed using YAML block sequence format
    subnets:
      - name: # Subnet name is arbitrary.
        ip-subnet: #Include the full CIDR range for the subnet

# List all VMs required for the workout. Multiple VMs may be listed using YAML block sequence format
servers:
  - name: # Server name is arbitrary
    image: # Use the exact name of the server image from Google Cloud
    machine_type: # Google Cloud VM type (i.e., "n1-standard-1")
    network_routing: # boolean value
    tags: # list tags for this VM (i.e., {items: ["http-server"]})
    metadata: # VM metadata
    snapshot: # Whether or not to take a snapshot of this server for recovery.
    # List all nics for this server. Multiple items may be included using YAML block sequence format
    nics:
      - network: # network name
        internal_IP: # VM IP address. Make sure this is within the subnet CIDR range
        subnet: # subnet name
        external_NAT: # boolean value

# List network routes. Multiple routes may be listed using YAML block sequence format.
# If no routes are needed, delete all sub-entries under 'routes:' and leave it empty
routes:
  - name: # route name
    network: # network name
    dest_range: # destination CIDR range
    next_hop_instance: # name of next hop VM

# List all firewall rules. Multiple rules may be listed using YAML block sequence format.
firewall_rules:
  - name: # rule name
    network: # network name
    target_tags: # list of target tags (i.e., ["http-server"])
    protocol: # network protocol
    ports: # list of affected ports (i.e., ["tcp/80,8080,443"])
    source_ranges: # list of source ranges (i.e., ["0.0.0.0/0"])

# List of assessment questions that are used to define how a workout is marked as complete.
# Question of types auto, input, or upload
assessment:
  type: "percentage"
  - questions:
    - type: auto
      question: "" # question or question description
      script: # script name (e.g. attack.py)
      script-language: # e.g. python
      server: # server that runs script. Takes server name from list of servers provided above
      operating-system: # target server os
      complete: False

redteam: # Optional: If this exists, build a redteam network according to the specification
  student-network-peer: # The name of the student network to peer with when creating the red team
  student-entry: # For each Red Team network, this is the specification for the Guacamole server to allow access.
    type: # Either RDP or VNC
    security-mode: # Optional: default "Any"
    domain: # Optionally used for connecting to Active Directory servers
    username: # The username for accessing RDP connections
    password: # The password used for connecting both RDP and VNC connections
    network: # The network in which to place the Gucamole server
    ip: # IP address the guacamole server should connect to
  servers: # The list of red team servers to add. Networks are dynamically assigned at this time.
    - name: # Name of the server
      image: # Use the exact name of the server image from Google Cloud
      machine_type: # Google Cloud VM type (i.e., "n1-standard-1")
      metadata: # VM metadata

weaknesses:
  - type: patch-removal
    specifications:
      patch: KB29387987
      delay: 10m
      target: all or cyber-arena-windows
  - type: plaintext-password
    specifications:

