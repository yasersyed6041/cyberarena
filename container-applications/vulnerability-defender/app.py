from flask import Flask, render_template, request, redirect, session
from google.cloud import datastore
from vulnerability_defender import vulnerability_defender

app = Flask(__name__)
app.register_blueprint(vulnerability_defender, url_prefix="/app")
app.secret_key = "R%FCm@a!@&3r31NJInxb!hRsrWbM6%rQ"
application_name = "vulnerability_defender"


@app.route('/<workout_id>', methods=['GET', 'POST'])
def workout_entry(workout_id):
    ds_client = datastore.Client()
    workout = ds_client.get(ds_client.key('cybergym-workout', workout_id))
    if not workout or ('type' not in workout and workout['name'] != application_name):
        return render_template('invalid_workout.html')
    else:
        return redirect(f"/app/{workout_id}")


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
